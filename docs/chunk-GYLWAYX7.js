import{a as w}from"./chunk-YQAL34G4.js";import{a as B,d as L,f as W,m as V,n as z,o as Z,s as q}from"./chunk-46GCKG2T.js";import{Da as M,Ha as g,Oa as p,Qa as b,Qb as R,Ra as i,Rb as A,Sa as t,Ta as m,Ua as H,Va as O,Wa as k,Wb as P,Xa as v,Ya as u,Yb as N,Z as I,_ as D,c as E,db as a,dc as j,eb as d,ib as S,jb as _,kb as x,nb as h,qb as T,tb as y,ua as l,vb as C,ya as F}from"./chunk-BULBJQPZ.js";var J=n=>({label:"Total Candidates",value:n,icon:"people-fill",color:"primary"}),K=n=>({label:"Interviews Scheduled",value:n,icon:"calendar2-event",color:"info"}),Q=n=>({label:"Interviews Completed",value:n,icon:"check2-circle",color:"success"}),U=n=>({label:"Overall Pass Rate",value:n,icon:"bar-chart-line",color:"warning"}),X=(n,r,e,o)=>[n,r,e,o];function Y(n,r){if(n&1&&(i(0,"div",13),m(1,"i",14),a(2),t()),n&2){let e=u();l(2),d(e.error)}}function $(n,r){n&1&&(i(0,"div",15),m(1,"div",16),t())}function ee(n,r){if(n&1&&(i(0,"div",41)(1,"div",42)(2,"div"),m(3,"i"),t(),i(4,"div",43),a(5),t(),i(6,"div",44),a(7),t()()()),n&2){let e=r.$implicit;l(2),b("icon-wrap bg-",e.color," bg-gradient"),l(),b("bi bi-",e.icon,""),l(2),d(e.label),l(2),d(e.value)}}function te(n,r){if(n&1&&(i(0,"option",45),a(1),t()),n&2){let e=r.$implicit;p("value",e),l(),d(e)}}function ie(n,r){if(n&1&&(i(0,"tr")(1,"td",46),a(2),t(),i(3,"td"),a(4),t(),i(5,"td"),a(6),t(),i(7,"td",47),a(8),t(),i(9,"td",48),a(10),t(),i(11,"td"),a(12),y(13,"number"),t()()),n&2){let e=r.$implicit;l(2),d(e[0].replace("-"," ")),l(2),d(e[1].total),l(2),d(e[1].completed),l(2),d(e[1].passed),l(2),d(e[1].failed),l(2),d(C(13,6,e[1].averageRating,"1.1-1"))}}function ne(n,r){if(n&1){let e=k();H(0),i(1,"div",17),g(2,ee,8,8,"div",18),y(3,"number"),t(),i(4,"div",19)(5,"div",20)(6,"div",21)(7,"div",22)(8,"h6",23),m(9,"i",24),a(10," Stage Progress"),t(),i(11,"select",25),x("ngModelChange",function(c){I(e);let s=u();return _(s.filteredStage,c)||(s.filteredStage=c),D(c)}),i(12,"option",26),a(13,"All Stages"),t(),g(14,te,2,2,"option",27),t()(),i(15,"div",28),m(16,"canvas",29),t()()(),i(17,"div",30)(18,"div",21)(19,"div",22)(20,"h6",23),m(21,"i",31),a(22," Pipeline Trend"),t()(),i(23,"div",32),m(24,"canvas",33),t()()()(),i(25,"div",34)(26,"div",35)(27,"h6",23),m(28,"i",36),a(29," Stage Statistics"),t()(),i(30,"div",37)(31,"table",38)(32,"thead",39)(33,"tr")(34,"th"),a(35,"Stage"),t(),i(36,"th"),a(37,"Total"),t(),i(38,"th"),a(39,"Completed"),t(),i(40,"th"),a(41,"Passed"),t(),i(42,"th"),a(43,"Failed"),t(),i(44,"th"),a(45,"Avg Rating"),t()()(),i(46,"tbody"),g(47,ie,14,9,"tr",40),t()()()(),O()}if(n&2){let e=u();l(2),p("ngForOf",T(15,X,h(7,J,e.metrics.totalCandidates),h(9,K,e.metrics.interviewsScheduled),h(11,Q,e.metrics.interviewsCompleted),h(13,U,C(3,4,e.metrics.overallPassRate,"1.0-0")+"%"))),l(9),S("ngModel",e.filteredStage),l(3),p("ngForOf",e.stageList()),l(33),p("ngForOf",e.displayedStageStats())}}var G=class n{constructor(r){this.fs=r}loading=!1;error="";metrics;filteredStage="all";autoRefresh=!1;refreshHandle;charts=[];ngOnInit(){this.load()}ngOnDestroy(){this.clearAuto(),this.destroyCharts()}toggleAuto(){this.autoRefresh?this.setAuto():this.clearAuto()}setAuto(){this.clearAuto(),this.refreshHandle=setInterval(()=>this.load(!0),3e4)}clearAuto(){this.refreshHandle&&(clearInterval(this.refreshHandle),this.refreshHandle=null)}load(r=!1){return E(this,null,function*(){r||(this.loading=!0,this.error="");try{this.metrics=yield this.fs.getHRDashboardMetrics(),setTimeout(()=>this.buildCharts(),0)}catch(e){this.error=e.message||"Failed to load metrics"}this.loading=!1})}stageList(){return Object.keys(this.metrics?.stageStats||{})}displayedStageStats(){if(!this.metrics)return[];let r=Object.entries(this.metrics.stageStats);return this.filteredStage==="all"?r:r.filter(e=>e[0]===this.filteredStage)}buildCharts(){if(this.destroyCharts(),!this.metrics)return;let r=document.getElementById("hrStageChart");if(r){let o=Object.keys(this.metrics.stageStats),c=o.map(f=>this.metrics.stageStats[f].completed),s=o.map(f=>this.metrics.stageStats[f].passed);this.charts.push(new w(r,{type:"bar",data:{labels:o,datasets:[{label:"Completed",data:c,backgroundColor:"#0d6efd"},{label:"Passed",data:s,backgroundColor:"#198754"}]},options:{responsive:!0,plugins:{legend:{position:"bottom"}},scales:{y:{beginAtZero:!0}}}}))}let e=document.getElementById("hrFunnelChart");if(e&&this.metrics.candidateFunnelData.length){let o=this.metrics.candidateFunnelData.map(s=>s.stage),c=this.metrics.candidateFunnelData.map(s=>s.candidateCount);this.charts.push(new w(e,{type:"line",data:{labels:o,datasets:[{label:"Pipeline",data:c,borderColor:"#6610f2",backgroundColor:"rgba(102,16,242,.15)",fill:!0,tension:.4}]},options:{responsive:!0,plugins:{legend:{position:"bottom"}}}}))}}destroyCharts(){this.charts.forEach(r=>r.destroy()),this.charts=[]}static \u0275fac=function(e){return new(e||n)(F(j))};static \u0275cmp=M({type:n,selectors:[["app-hr-dashboard"]],decls:17,vars:5,consts:[[1,"container-fluid","py-4","dashboard-wrapper"],[1,"d-flex","flex-wrap","justify-content-between","align-items-center","mb-4","gap-3"],[1,"fw-bold","mb-1"],[1,"text-muted"],[1,"d-flex","gap-2","align-items-center"],[1,"form-check","form-switch","small","me-2"],["type","checkbox","id","autoRef",1,"form-check-input",3,"ngModelChange","change","ngModel"],["for","autoRef",1,"form-check-label"],[1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"bi","bi-arrow-clockwise"],["class","alert alert-danger py-2 small d-flex align-items-center gap-2",4,"ngIf"],["class","text-center py-5",4,"ngIf"],[4,"ngIf"],[1,"alert","alert-danger","py-2","small","d-flex","align-items-center","gap-2"],[1,"bi","bi-exclamation-triangle-fill"],[1,"text-center","py-5"],[1,"spinner-border","text-primary"],[1,"row","g-4","mb-1"],["class","col-6 col-md-3",4,"ngFor","ngForOf"],[1,"row","g-4","mt-1"],[1,"col-xl-7"],[1,"card","h-100","shadow-sm","rounded-4"],[1,"card-header","bg-transparent","border-0","d-flex","align-items-center","justify-content-between","py-3"],[1,"mb-0","fw-semibold"],[1,"bi","bi-diagram-3","me-1","text-primary"],[1,"form-select","form-select-sm","w-auto",3,"ngModelChange","ngModel"],["value","all"],[3,"value",4,"ngFor","ngForOf"],[1,"card-body","pt-0"],["id","hrStageChart","height","220"],[1,"col-xl-5"],[1,"bi","bi-graph-up-arrow","me-1","text-primary"],[1,"card-body","pt-2"],["id","hrFunnelChart","height","220"],[1,"card","shadow-sm","rounded-4","mt-4"],[1,"card-header","bg-transparent","border-0","py-3","d-flex","align-items-center","gap-2"],[1,"bi","bi-table","me-1","text-primary"],[1,"table-responsive"],[1,"table","table-sm","align-middle","mb-0"],[1,"table-light"],[4,"ngFor","ngForOf"],[1,"col-6","col-md-3"],[1,"kpi-card","h-100","shadow-sm","rounded-4","p-3","p-lg-4","position-relative"],[1,"mt-2","small","text-uppercase","fw-semibold","text-muted","tracking-tight"],[1,"display-value","fw-bold"],[3,"value"],[1,"text-capitalize"],[1,"text-success","fw-semibold"],[1,"text-danger","fw-semibold"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div")(3,"h3",2),a(4,"HR Dashboard"),t(),i(5,"small",3),a(6,"Operational hiring oversight & performance indicators"),t()(),i(7,"div",4)(8,"div",5)(9,"input",6),x("ngModelChange",function(s){return _(o.autoRefresh,s)||(o.autoRefresh=s),s}),v("change",function(){return o.toggleAuto()}),t(),i(10,"label",7),a(11,"Auto 30s"),t()(),i(12,"button",8),v("click",function(){return o.load()}),m(13,"i",9),t()()(),g(14,Y,3,1,"div",10)(15,$,2,0,"div",11)(16,ne,48,20,"ng-container",12),t()),e&2&&(l(9),S("ngModel",o.autoRefresh),l(3),p("disabled",o.loading),l(2),p("ngIf",o.error),l(),p("ngIf",o.loading),l(),p("ngIf",!o.loading&&o.metrics))},dependencies:[N,R,A,P,q,z,Z,B,V,L,W],styles:[".dashboard-wrapper[_ngcontent-%COMP%]{max-width:1200px}.small-metric[_ngcontent-%COMP%]{border:none}"]})};export{G as HrDashboardComponent};
